<!DOCTYPE html>
<!--[if lt IE 7]> <html lang="en" class="no-js ie6"> <![endif]--><!--[if IE 7]>    <html lang="en" class="no-js ie7"> <![endif]--><!--[if IE 8]>    <html lang="en" class="no-js ie8"> <![endif]-->
<!--[if gt IE 8]><!-->
  <html class='no-js' lang='en'>
  <!--<![endif]-->
  <head>
    <meta charset='utf-8' />
    <meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible' />
    <title>The page template</title>
    <meta content='' name='description' />
    <meta content='' name='author' />
    <base href="/" />
    <meta content='width=device-width, initial-scale=1.0' name='viewport' />
    <link type="text/css" rel="stylesheet" href="/js/lib/jquery-ui/themes/base/jquery.ui.all.css" />
    <link type="text/css" rel="stylesheet" href="/js/lib/jquery-notify/ui.notify.css" />
    <link type="text/css" rel="stylesheet" href="/css/style.css" />
    <style type="text/css">
      body {
        margin: 0;
        padding: 0;
      }
      
      .ui-notify {
        color: #fff;
      }
      
      span.cke_skin_kama {
        padding: 0 !important;
      }
    </style>
  </head>
  <body>
    <!-- page content -->
    <script type="text/javascript">
      //<![CDATA[
      (function(b) {
        function c() {
        }
        for (var d = "assert,count,debug,dir,dirxml,error,exception,group,groupCollapsed,groupEnd,info,log,markTimeline,profile,profileEnd,time,timeEnd,trace,warn".split(","), a; a = d.pop();) 
          b[a] = b[a] || c
      })(window.console = window.console || {});
      //]]>
    </script>
    <script type="text/javascript" src="/js/lib/jquery.min.js">
    </script>
    <script type="text/javascript" src="/js/lib/jquery-ui/ui/jquery.ui.core.js">
    </script>
    <script type="text/javascript" src="/js/lib/jquery-ui/ui/jquery.ui.widget.js">
    </script>
    <script type="text/javascript" src="/js/lib/jquery-notify/src/jquery.notify.min.js">
    </script>
    <script type="text/javascript" src="/js/lib/jquery.form.js">
    </script>
    <script type="text/javascript" src="/js/lib/ckeditor/ckeditor.js">
    </script>
    <script type="text/javascript" src="/js/lib/ckeditor/adapters/jquery.js">
    </script>
    <script type="text/javascript" src="/kern.methods.js">
    </script>
    <script type="text/javascript" src="/kern.bone.js">
    </script>
    <script type="text/javascript" src="/kern.js">
    </script>
    <script type="text/javascript">
      (function($) {
        $(window).load(function() {
          console.info('Starting editor');
          var $notifier = $('#notifier').css({
            'z-index': 10000,
            position: 'absolute'
          }).notify();
          
          function submitCallback(data, statusText, xhr, $form) {
            console.info(data, statusText);
            var error = data.success ? '' : '<div class="error">' + data.error.message + '</div>';
            $notifier.notify('create', {
              title: data.success ? 'Success!' : 'Error',
              text: $('[name=document-title]').val() + (data.success ? ' has been saved!' : ' could not be saved.') + error
            }, {
              expires: data.success
            });
          }
          
          function ckeditorSave() {
            $('form').ajaxSubmit({
              url: $('form').attr('rel'),
              dataType: 'json',
              success: submitCallback
            });
            return false;
          }
          window.ckeditorSave = ckeditorSave;
          
          $('form').attr('rel', $('form').attr('action')).attr('action', 'javascript:ckeditorSave();void(0);');
          
          
          
          $('textarea').ckeditor(function() {
          }, {
            docType: '<!DOCTYPE HTML>',
            scayt_autoStartup: true,
            fullPage: true,
            //      extraPlugins: 'kernSave',
            //      extraPlugins: 'stylesheetparser',
            contentsCss: '/css/style.css',
            resize_enabled: false
          
          }).bind('instanceReady.ckeditor', function() {
            console.info('instanceReady.ckeditor');
            var editor = $(this).ckeditorGet();
            
            // doesn't work... too bad
            editor.on('maximize', function(evt) {
              $('html, body, form').css({
                position: 'relative',
                width: '100%',
                height: '100%'
              });
              console.info('Maximized editor');
            });
            
            editor.execCommand('maximize');
            
            $('html, body, form').css({
              position: 'relative',
              width: '100%',
              height: '100%'
            });
          });
          
          $('textarea').bind('setData.ckeditor', function(ev, opt) {
            console.info('setData', arguments);
          }).bind('getData.ckeditor', function(ev, opt) {
            console.info('getData', arguments);
          });
          
        });
      })(jQuery);
    </script>
    <!--[if lt IE 7 ]>
      <script defer src="//ajax.googleapis.com/ajax/libs/chrome-frame/1.0.3/CFInstall.min.js"></script>
      <script defer>window.attachEvent("onload",function(){CFInstall.check({mode:"overlay"})})</script>
    <![endif]-->
  </body>
</html>
